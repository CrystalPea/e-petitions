class AddRegionIdToConstituencies < ActiveRecord::Migration[5.2]
  disable_ddl_transaction!

  class Constituency < ActiveRecord::Base; end

  def up
    transaction do
      add_column :constituencies, :region_id, :string, limit: 30
      add_index :constituencies, :region_id
      add_foreign_key :constituencies, :regions, primary_key: :external_id
    end

    # Data for this comes from the Parliament OData API:
    # http://data.parliament.uk/membersdataplatform/open/OData.svc/ConstituencyAreas?$filter=Area/AreaType_Id+eq+8+and+Constituency/EndDate+eq+null&$select=Constituency_Id,Area_Id
    [
      %w[14 117], %w[20 117], %w[36 117], %w[59 117], %w[67 117],
      %w[99 117], %w[110 117], %w[216 117], %w[543 117], %w[614 117],
      %w[728 117], %w[804 117], %w[911 117], %w[914 117], %w[922 117],
      %w[927 117], %w[929 117], %w[965 117], %w[985 117], %w[991 117],
      %w[994 117], %w[1035 117], %w[1041 117], %w[1047 117], %w[1048 117],
      %w[1054 117], %w[1115 117], %w[1203 117], %w[1204 117], %w[1205 117],
      %w[1206 117], %w[1207 117], %w[1208 117], %w[1209 117], %w[1274 117],
      %w[1284 117], %w[1555 117], %w[1561 117], %w[1624 117], %w[1661 117],
      %w[1678 117], %w[1782 117], %w[1826 117], %w[1977 117], %w[2004 117],
      %w[2022 117], %w[2025 117], %w[2104 117], %w[2135 117], %w[2234 117],
      %w[2256 117], %w[2285 117], %w[2286 117], %w[2316 117], %w[2456 117],
      %w[2501 117], %w[2784 117], %w[3096 117], %w[3117 117], %w[3287 116],
      %w[3288 116], %w[3289 114], %w[3290 111], %w[3291 108], %w[3292 116],
      %w[3293 110], %w[3294 116], %w[3295 114], %w[3296 110], %w[3297 114],
      %w[3298 108], %w[3299 114], %w[3300 114], %w[3301 113], %w[3302 109],
      %w[3303 109], %w[3304 108], %w[3305 112], %w[3306 114], %w[3307 110],
      %w[3308 115], %w[3309 109], %w[3310 113], %w[3311 114], %w[3312 113],
      %w[3313 112], %w[3314 118], %w[3315 118], %w[3316 118], %w[3317 118],
      %w[3318 113], %w[3319 107], %w[3320 113], %w[3321 109], %w[3322 114],
      %w[3323 113], %w[3324 108], %w[3325 111], %w[3326 111], %w[3327 111],
      %w[3328 111], %w[3329 111], %w[3330 111], %w[3331 111], %w[3332 111],
      %w[3333 111], %w[3334 107], %w[3335 108], %w[3336 108], %w[3337 108],
      %w[3338 108], %w[3339 116], %w[3340 107], %w[3341 107], %w[3342 114],
      %w[3343 110], %w[3344 108], %w[3345 108], %w[3346 108], %w[3347 108],
      %w[3348 110], %w[3349 110], %w[3350 115], %w[3351 115], %w[3352 114],
      %w[3353 109], %w[3354 109], %w[3355 109], %w[3356 112], %w[3357 116],
      %w[3358 113], %w[3359 113], %w[3360 113], %w[3361 112], %w[3362 116],
      %w[3363 115], %w[3364 109], %w[3365 114], %w[3366 114], %w[3367 115],
      %w[3368 115], %w[3369 115], %w[3370 115], %w[3371 112], %w[3372 113],
      %w[3373 111], %w[3374 112], %w[3375 110], %w[3376 114], %w[3377 108],
      %w[3378 111], %w[3379 108], %w[3380 108], %w[3381 112], %w[3382 116],
      %w[3383 109], %w[3384 113], %w[3385 115], %w[3386 112], %w[3387 111],
      %w[3388 114], %w[3389 116], %w[3390 116], %w[3391 116], %w[3392 116],
      %w[3393 108], %w[3394 116], %w[3395 116], %w[3396 113], %w[3397 112],
      %w[3398 115], %w[3399 112], %w[3400 116], %w[3401 110], %w[3402 114],
      %w[3403 108], %w[3404 112], %w[3405 113], %w[3406 115], %w[3407 114],
      %w[3408 110], %w[3409 114], %w[3410 113], %w[3411 115], %w[3412 113],
      %w[3413 108], %w[3414 115], %w[3415 113], %w[3416 108], %w[3417 107],
      %w[3418 112], %w[3419 109], %w[3420 116], %w[3421 116], %w[3422 112],
      %w[3423 109], %w[3424 108], %w[3425 108], %w[3426 110], %w[3427 111],
      %w[3428 111], %w[3429 111], %w[3430 114], %w[3431 108], %w[3432 113],
      %w[3433 113], %w[3434 113], %w[3435 116], %w[3436 113], %w[3437 107],
      %w[3438 114], %w[3439 110], %w[3440 116], %w[3441 108], %w[3442 110],
      %w[3443 110], %w[3444 110], %w[3445 115], %w[3446 109], %w[3447 109],
      %w[3448 109], %w[3449 109], %w[3450 114], %w[3451 111], %w[3452 111],
      %w[3453 113], %w[3454 116], %w[3455 113], %w[3456 113], %w[3457 113],
      %w[3458 107], %w[3459 118], %w[3460 115], %w[3461 113], %w[3462 114],
      %w[3463 118], %w[3464 114], %w[3465 114], %w[3466 109], %w[3467 114],
      %w[3468 114], %w[3469 108], %w[3470 113], %w[3471 108], %w[3472 109],
      %w[3473 113], %w[3474 113], %w[3475 113], %w[3476 112], %w[3477 114],
      %w[3478 110], %w[3479 113], %w[3480 114], %w[3481 115], %w[3482 114],
      %w[3483 114], %w[3484 113], %w[3485 118], %w[3486 115], %w[3487 113],
      %w[3488 114], %w[3489 115], %w[3490 118], %w[3491 108], %w[3492 110],
      %w[3493 108], %w[3494 107], %w[3495 110], %w[3496 114], %w[3497 115],
      %w[3498 114], %w[3499 116], %w[3500 110], %w[3501 114], %w[3502 109],
      %w[3503 112], %w[3504 113], %w[3505 114], %w[3506 113], %w[3507 113],
      %w[3508 111], %w[3509 109], %w[3510 109], %w[3511 108], %w[3512 113],
      %w[3513 113], %w[3514 110], %w[3515 112], %w[3516 109], %w[3517 113],
      %w[3518 113], %w[3519 107], %w[3520 112], %w[3521 114], %w[3522 114],
      %w[3523 113], %w[3524 108], %w[3525 112], %w[3526 109], %w[3527 113],
      %w[3528 114], %w[3529 111], %w[3530 112], %w[3531 112], %w[3532 107],
      %w[3533 108], %w[3534 110], %w[3535 112], %w[3536 113], %w[3537 113],
      %w[3538 113], %w[3539 114], %w[3540 107], %w[3541 114], %w[3542 109],
      %w[3543 112], %w[3544 108], %w[3545 113], %w[3546 113], %w[3547 112],
      %w[3548 114], %w[3549 113], %w[3550 113], %w[3551 116], %w[3552 107],
      %w[3553 109], %w[3554 111], %w[3555 113], %w[3556 110], %w[3557 113],
      %w[3558 109], %w[3559 109], %w[3560 109], %w[3561 115], %w[3562 108],
      %w[3563 118], %w[3564 108], %w[3565 109], %w[3566 109], %w[3567 109],
      %w[3568 109], %w[3569 109], %w[3570 110], %w[3571 110], %w[3572 110],
      %w[3573 108], %w[3574 114], %w[3575 113], %w[3576 113], %w[3577 113],
      %w[3578 113], %w[3579 111], %w[3580 110], %w[3581 108], %w[3582 108],
      %w[3583 108], %w[3584 108], %w[3585 116], %w[3586 110], %w[3587 110],
      %w[3588 111], %w[3589 112], %w[3590 112], %w[3591 108], %w[3592 114],
      %w[3593 114], %w[3594 108], %w[3595 112], %w[3596 108], %w[3597 108],
      %w[3598 108], %w[3599 110], %w[3600 114], %w[3601 111], %w[3602 116],
      %w[3603 112], %w[3604 110], %w[3605 115], %w[3606 112], %w[3607 114],
      %w[3608 118], %w[3609 111], %w[3610 107], %w[3611 107], %w[3612 114],
      %w[3613 114], %w[3614 113], %w[3615 114], %w[3616 116], %w[3617 116],
      %w[3618 108], %w[3619 109], %w[3620 116], %w[3621 114], %w[3622 114],
      %w[3623 110], %w[3624 114], %w[3625 107], %w[3626 107], %w[3627 107],
      %w[3628 111], %w[3629 116], %w[3630 116], %w[3631 118], %w[3632 115],
      %w[3633 109], %w[3634 118], %w[3635 115], %w[3636 115], %w[3637 115],
      %w[3638 118], %w[3639 107], %w[3640 112], %w[3641 112], %w[3642 110],
      %w[3643 114], %w[3644 112], %w[3645 115], %w[3646 111], %w[3647 112],
      %w[3648 111], %w[3649 115], %w[3650 115], %w[3651 114], %w[3652 107],
      %w[3653 111], %w[3654 112], %w[3655 107], %w[3656 114], %w[3657 110],
      %w[3658 112], %w[3659 115], %w[3660 110], %w[3661 110], %w[3662 112],
      %w[3663 112], %w[3664 110], %w[3665 110], %w[3666 110], %w[3667 111],
      %w[3668 116], %w[3669 113], %w[3670 108], %w[3671 108], %w[3672 113],
      %w[3673 114], %w[3674 114], %w[3675 108], %w[3676 109], %w[3677 108],
      %w[3678 112], %w[3679 115], %w[3680 115], %w[3681 116], %w[3682 115],
      %w[3683 113], %w[3684 114], %w[3685 114], %w[3686 116], %w[3687 108],
      %w[3688 109], %w[3689 113], %w[3690 112], %w[3691 114], %w[3692 114],
      %w[3693 107], %w[3694 111], %w[3695 114], %w[3696 116], %w[3697 108],
      %w[3698 109], %w[3699 113], %w[3700 108], %w[3701 114], %w[3702 112],
      %w[3703 113], %w[3704 114], %w[3705 108], %w[3706 109], %w[3707 109],
      %w[3708 111], %w[3709 113], %w[3710 114], %w[3711 110], %w[3712 110],
      %w[3713 112], %w[3714 108], %w[3715 115], %w[3716 109], %w[3717 109],
      %w[3718 107], %w[3719 108], %w[3720 109], %w[3721 114], %w[3722 109],
      %w[3723 109], %w[3724 109], %w[3725 109], %w[3726 109], %w[3727 110],
      %w[3728 109], %w[3729 111], %w[3730 114], %w[3731 109], %w[3732 110],
      %w[3733 114], %w[3734 111], %w[3735 115], %w[3736 118], %w[3737 112],
      %w[3738 112], %w[3739 110], %w[3740 115], %w[3741 118], %w[3742 112],
      %w[3743 115], %w[3744 110], %w[3745 110], %w[3746 112], %w[3747 110],
      %w[3748 108], %w[3749 107], %w[3750 111], %w[3751 112], %w[3752 115],
      %w[3753 114], %w[3754 112], %w[3755 115], %w[3756 112], %w[3757 112],
      %w[3758 114], %w[3759 115], %w[3760 114], %w[3761 114], %w[3762 112],
      %w[3763 108], %w[3764 114], %w[3765 112], %w[3766 115], %w[3767 108],
      %w[3768 108], %w[3769 115], %w[3770 111], %w[3771 111], %w[3772 108],
      %w[3773 112], %w[3774 108], %w[3775 107], %w[3776 107], %w[3777 111],
      %w[3778 111], %w[3779 111], %w[3780 111], %w[3781 111], %w[3782 118],
      %w[3783 111], %w[3784 113], %w[3785 108], %w[3786 115], %w[3787 112],
      %w[3788 107], %w[3789 114], %w[3790 113], %w[3791 111], %w[3792 116],
      %w[3793 116], %w[3794 111], %w[3795 108], %w[3796 115], %w[3797 111],
      %w[3798 115], %w[3799 115], %w[3800 111], %w[3801 109], %w[3802 115],
      %w[3803 112], %w[3804 115], %w[3805 114], %w[3806 113], %w[3807 115],
      %w[3808 116], %w[3809 115], %w[3810 115], %w[3811 113], %w[3812 115],
      %w[3813 114], %w[3814 113], %w[3815 107], %w[3816 118], %w[3817 113],
      %w[3818 116], %w[3819 116], %w[3820 113], %w[3821 109], %w[3822 108],
      %w[3823 111], %w[3824 111], %w[3825 113], %w[3826 107], %w[3827 114],
      %w[3828 111], %w[3829 108], %w[3830 108], %w[3831 111], %w[3832 107],
      %w[3833 112], %w[3834 112], %w[3835 114], %w[3836 108], %w[3837 110],
      %w[3838 115], %w[3839 112], %w[3840 109], %w[3841 111], %w[3842 111],
      %w[3843 115], %w[3844 113], %w[3845 108], %w[3846 112], %w[3847 118],
      %w[3848 111], %w[3849 113], %w[3850 108], %w[3851 115], %w[3852 108],
      %w[3853 113], %w[3854 114], %w[3855 114], %w[3856 108], %w[3857 108],
      %w[3858 112], %w[3859 114], %w[3860 114], %w[3861 114], %w[3862 111],
      %w[3863 111], %w[3864 111], %w[3865 111], %w[3866 108], %w[3867 108],
      %w[3868 114], %w[3869 116], %w[3870 114], %w[3871 108], %w[3872 111],
      %w[3873 108], %w[3874 115], %w[3875 116], %w[3876 109], %w[3877 109]
    ].each do |external_id, region_id|
      Constituency.where(external_id: external_id).update_all(region_id: region_id)
    end
  end

  def down
    transaction do
      remove_foreign_key :constituencies, :regions
      remove_index :constituencies, :region_id
      remove_column :constituencies, :region_id
    end
  end
end
